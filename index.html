<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RLOY HOSTING - PT BKI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-black text-white p-6">
    <div class="max-w-md mx-auto bg-zinc-900 p-8 rounded-[2rem] border border-zinc-800 shadow-2xl">
        <h1 class="text-3xl font-black text-blue-500">RLOY <span class="text-white text-xs font-light tracking-widest uppercase">Panel</span></h1>
        <p class="text-[10px] text-gray-500 mb-8 tracking-widest">PT BANGGA KARYA INDONESIA</p>

        <div class="space-y-4">
            <input type="text" id="siteName" placeholder="Nama Web (Misal: RK)" 
                class="w-full bg-black border border-zinc-800 p-4 rounded-2xl outline-none focus:border-blue-500">
            
            <textarea id="htmlCode" placeholder="Tempel Kode HTML di sini..." rows="8"
                class="w-full bg-black border border-zinc-800 p-4 rounded-2xl outline-none focus:border-blue-500 font-mono text-sm"></textarea>
            
            <button onclick="deployKeRloy()" id="btn"
                class="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-2xl font-black tracking-widest transition-all">
                DEPLOY / UPDATE
            </button>
        </div>

        <div id="hasil" class="hidden mt-8 p-4 bg-blue-900/20 border border-blue-800 rounded-2xl text-center">
            <p class="text-xs text-blue-300">WEB BERHASIL PUBLIK:</p>
            <a id="linkHasil" href="#" target="_blank" class="text-white font-bold block mt-2 underline break-all"></a>
        </div>
    </div>

    <script>
        // Data dari dashboard Supabase Bapak
        const SUB_URL = "https://gsclgqtzvrkabtqyrtkh.supabase.co";
        const SUB_KEY = "sb_publishable_oVtbFbHKvpHICGCAs19gmA_56miLSTt";
        const supabase = supabase.createClient(SUB_URL, SUB_KEY);

        async function deployKeRloy() {
            const name = document.getElementById('siteName').value.toLowerCase();
            const content = document.getElementById('htmlCode').value;
            const btn = document.getElementById('btn');

            if(!name || !content) return alert("Isi nama dan kode dulu, Pak!");

            btn.innerText = "SEDANG MEMPROSES...";
            btn.disabled = true;

            // Fitur UPSERT: Simpan Baru ATAU Update Jika Nama Sudah Ada
            const { error } = await supabase
                .from('rloy-sites')
                .upsert({ id_name: name, html_content: content }, { onConflict: 'id_name' });

            if(error) {
                alert("Gagal Pak! " + error.message);
                btn.innerText = "DEPLOY / UPDATE";
                btn.disabled = false;
            } else {
                const linkFinal = window.location.origin + "/view.html?id=" + name;
                document.getElementById('hasil').classList.remove('hidden');
                document.getElementById('linkHasil').innerText = linkFinal;
                document.getElementById('linkHasil').href = linkFinal;
                btn.innerText = "BERHASIL DIUPDATE!";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
